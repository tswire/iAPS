var freeaps_glucoseGetLast;(()=>{var e={6237:e=>{function a(e){return e.date||Date.parse(e.display_time)||Date.parse(e.dateString)}function o(e,a){a||(a=0);var o=Math.pow(10,a);return Math.round(e*o)/o}e.exports=function(e){var t=(e=e.filter((function(e){return e.glucose||e.sgv})).map((function(e){if(e.glucose=e.glucose||e.sgv,null!==e.glucose)return e}))).length;const r=e[0],l=a(r),u=a(r);var n,s=[],c=[],g=[],d=[];if(1==t)return{glucose:r.glucose,noise:0,delta:0,shortAvgDelta:0,longAvgDelta:0,date:u,dura_ISF_minutes:0,dura_ISF_average:r.glucose,slope05:0,slope15:0,slope40:0,dura_p:0,delta_pl:0,delta_pn:0,bg_acceleration:0,a_0:0,a_1:0,a_2:0,r_squ:0};for(var i=0,_=1;_<t;_++){if(void 0!==e[_]&&"cal"===e[_].type){i=_;break}if(void 0!==e[_]&&e[_].glucose>38&&e[_].device===r.device){const t=e[_],u=a(t);var h,p=0;if(void 0!==u&&void 0!==l?(h=Math.round((l-u)/6e4),n=r.glucose-t.glucose,p=n/h*5,console.error("then minutesAgo = "+h+" avgDelta = "+o(p,2))):console.error("Error: date field not found: cannot calculate avgDel"),d.push(p),0<h&&h<2.5)r.glucose=(r.glucose+t.glucose)/2;else if(2.5<h&&h<17.5)c.push(p),2.5<h&&h<7.5&&s.push(p);else{if(!(17.5<h&&h<42.5))break;g.push(p)}}}var v=0,f=0,M=0,b=0;c.length>0&&(f=c.reduce((function(e,a){return e+a}))/c.length),v=s.length>0?s.reduce((function(e,a){return e+a}))/s.length:f,g.length>0&&(M=g.reduce((function(e,a){return e+a}))/g.length),d.length>0&&(b=d[0],console.error("most actual available avgDelta = "+o(b,2)));var m=r.glucose,w=m,k=0,F=a(r);for(_=1;_<t;_++){const o=e[_],t=a(o);if(m=Math.min(m,o.glucose),w=Math.max(w,o.glucose),w-m>2||F-t>66e4||u-t>36e5)break;k=(u-(F=t))/6e4}r.glucose;var x=0,D=0,S=0,I=0,A=0,q=0;var y=r.glucose,G=r.glucose,L=0;for(_=1;_<t;_++){const o=e[_],t=a(o);if(Math.round((l-t)/6e4)-L>13)break;if(!(o.glucose>.95*G&&o.glucose<1.05*G))break;y+=o.glucose,G=y/(_+1),L=Math.round((l-t)/6e4)}x=1.05,D=1.15,S=1.4,y=0;var E,j,z=0,B=0,C=0,H=7.5;for(_=0;_<t;_++){if(E=_*B==z*z?0:(_*C-z*y)/(_*B-z*z),(j=(l-a(oe=e[_]))/6e4)>H&&7.5==H&&(x=5*-E,H=17.5),j>H&&17.5==H&&(D=5*-E,H=42.5),j>H&&42.5==H){S=5*-E;break}z+=j,B+=j*j,y+=oe.glucose,oe.glucose*oe.glucose,C+=oe.glucose*j}I=0,A=0,q=0;var J,K=0,N=0,O=0,P=0,Q=0;if(t>3){var R=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=a(e[0]),$=0,ee=300,ae=50;for(_=0;_<t;_++){var oe,te=(a(oe=e[_])-Z)/1e3/ee;if(-te*ee>2820)break;if(te<$-1.5){(_<3||-te*ee<600)&&(I=-$*ee/60,A=0,q=0,K=0,N=0,O=0,P=0,Q=0);break}$=te;var re=oe.glucose/ae;T+=te,U+=Math.pow(te,2),V+=Math.pow(te,3),W+=Math.pow(te,4),R+=re,X+=te*re,Y+=Math.pow(te,2)*re;var le=_+1,ue=0,ne=0,se=0,ce=0;if(le>=4&&-te*ee>=600&&(ue=W*(U*le-T*T)-V*(V*le-T*U)+U*(V*T-U*U),ne=Y*(U*le-T*T)-X*(V*le-T*U)+R*(V*T-U*U),se=W*(X*le-R*T)-V*(Y*le-R*U)+U*(Y*T-X*U),ce=W*(U*R-T*X)-V*(V*R-T*Y)+U*(V*X-U*Y)),0!=ue){var ge=ne/ue;E=se/ue;for(var de=ce/ue,ie=R/le,_e=0,he=0,pe=0;pe<=_;pe++){var ve=e[pe],fe=a(ve);_e+=Math.pow(ve.glucose/ae-ie,2);var Me=(fe-Z)/1e3/ee,be=ge*Math.pow(Me,2)+E*Me+de;he+=Math.pow(ve.glucose/ae-be,2)}var me=.64;if(0!=_e&&(me=1-he/_e),le>3&&me>=N){N=me,I=-te*ee/60;A=-50*(ge*Math.pow(-1,2)-1*E),q=ae*(ge*Math.pow(1,2)+1*E),K=2*ge*ae,O=de*ae,P=E*ae,Q=ge*ae,ge*ae,E*ae,de*ae}}}}return J="glucose: "+o(r.glucose,0)+", noise: 0 , delta: "+o(v,0)+", short_avgdelta:  "+o(f,2)+", long_avgdelta: "+o(M,2)+", cgmFlatMinutes: "+o(k,0)+", date: "+r.date+", dura_ISF_minutes: "+o(L,0)+", dura_ISF_average: "+o(G,2)+", slope05 : "+o(x,2)+", slope15: "+o(D,2)+", slope40: "+o(S,2)+", parabola_fit_correlation: "+o(N,4)+", parabola_fit_minutes: "+o(I,2)+", parabola_fit_last_delta: "+o(A,2)+", parabola_fit_next_delta: "+o(q,2)+", parabola_fit_a0: "+o(O,2)+", parabola_fit_a1: "+o(P,2)+", parabola_fit_a2: "+o(Q,2)+", bg_acceleration: "+o(K,2),{glucose:Math.round(1e4*r.glucose)/1e4,noise:0,delta:Math.round(1e4*v)/1e4,short_avgdelta:Math.round(1e4*f)/1e4,long_avgdelta:Math.round(1e4*M)/1e4,avgdelta:Math.round(1e4*b)/1e4,cgmFlatMinutes:Math.round(1e4*k)/1e4,dura_ISF_minutes:Math.round(1e4*L)/1e4,dura_ISF_average:Math.round(1e4*G)/1e4,slope05:Math.round(1e4*x)/1e4,slope15:Math.round(1e4*D)/1e4,slope40:Math.round(1e4*S)/1e4,dura_p:Math.round(1e4*I)/1e4,delta_pl:Math.round(1e4*A)/1e4,delta_pn:Math.round(1e4*q)/1e4,bg_acceleration:K,r_squ:Math.round(1e4*N)/1e4,a_0:Math.round(1e4*O)/1e4,a_1:Math.round(1e4*P)/1e4,a_2:Math.round(1e4*Q)/1e4,pp_debug:J,date:l,last_cal:i,device:r.device}}}},a={};var o=function o(t){var r=a[t];if(void 0!==r)return r.exports;var l=a[t]={exports:{}};return e[t](l,l.exports,o),l.exports}(6237);freeaps_glucoseGetLast=o})();